(()=>{"use strict";const e={secret:"416c696365"+"00".repeat(27),nonce:"01".repeat(32)},n={secret:"426f62"+"00".repeat(29),nonce:"02".repeat(32)};window.runOfflineTransferTest=async function(){try{console.log("=== Starting Offline Transfer Test ==="),console.log("Step 1: Minting token for Alice...");const o={data:"Test NFT for offline transfer",amount:100},t=await mintToken(JSON.stringify(e),JSON.stringify(o)),i=JSON.parse(t);console.log("Token minted successfully:",i.tokenId),console.log("\nStep 2: Generating Bob's receiving address...");const r=n.secret.match(/.{2}/g),s=n.nonce.match(/.{2}/g);if(!r||!s)throw new Error("Invalid Bob identity format");const a=new Uint8Array(r.map(e=>parseInt(e,16))),c=new Uint8Array(s.map(e=>parseInt(e,16))),l=await window.unicity.SigningService.createFromSecret(a,c),f=new window.unicity.PredicateJsonFactory,d=new window.unicity.TokenFactory(new window.unicity.TokenJsonSerializer(f)),g=await d.create(i.token);console.log("Reconstructed token type:",g.type);const w=await window.unicity.MaskedPredicate.calculateReference(g.type,l.algorithm,l.publicKey,window.unicity.HashAlgorithm.SHA256,c),y=(await window.unicity.DirectAddress.create(w)).toJSON();console.log("Bob's receiving address:",y),console.log("\nStep 3: Alice preparing offline transfer to Bob...");const p=await prepareTransfer(JSON.stringify(e),y,JSON.stringify(i),!0),S=JSON.parse(p);console.log("Offline transfer package created"),console.log("Transfer package size:",JSON.stringify(S).length,"bytes"),console.log("\nStep 4: Simulating offline data transfer..."),console.log("In a real scenario, this package would be transferred via NFC"),console.log("\nStep 5: Bob finalizing the received transfer...");const u=await finalizeReceivedTransaction(JSON.stringify(n),JSON.stringify(S)),T=JSON.parse(u);console.log("Transfer finalized successfully!"),console.log("Token ID:",T.tokenId),console.log("New owner: Bob"),console.log("\nStep 6: Verifying transfer..."),console.log("Token is now owned by Bob"),console.log("Alice no longer owns the token"),console.log("\n=== Offline Transfer Test Completed Successfully ==="),window.Android&&window.Android.showToast("Offline transfer test completed successfully!")}catch(e){throw console.error("Offline transfer test failed:",e),window.Android&&window.Android.showToast("Test failed: "+e.message),e}}})();